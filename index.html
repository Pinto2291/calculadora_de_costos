<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Estructura de Costos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: 'Poppins', sans-serif; }
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none; margin: 0;
        }
        input[type=number] { -moz-appearance: textfield; }
    </style>
</head>
<body class="bg-gray-900 text-white antialiased">
    <div class="container mx-auto p-4 max-w-6xl">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-emerald-400" id="nombre-procedimiento-header">Calculadora de Estructura de Costos</h1>
            <p class="text-gray-400 mt-2">Calcula el precio de venta a partir de tus insumos y costos.</p>
        </header>

        <div class="mb-6">
            <label for="bcv" class="block text-sm font-medium text-gray-400 mb-1">Tasa del Dólar BCV (Bs)</label>
            <input type="number" id="bcv" placeholder="Ej: 36.50" class="w-full bg-gray-700 text-white p-3 rounded-lg" step="0.01">
        </div>

        <div class="mb-6">
            <label for="nombre-procedimiento" class="block text-sm font-medium text-gray-400 mb-1">Nombre del Procedimiento</label>
            <input type="text" id="nombre-procedimiento" placeholder="Limpieza facial" class="w-full bg-gray-700 text-white p-3 rounded-lg">
        </div>

        <main class="bg-gray-800 rounded-2xl shadow-2xl p-6 space-y-8">
            <div>
                <h2 class="text-xl font-semibold mb-4">1. Lista de Costos y Materiales</h2>
                <div class="grid grid-cols-7 md:grid-cols-8 gap-2 text-sm text-gray-400 mb-2">
                    <div class="col-span-2">Insumo</div>
                    <div class="col-span-1">Costo ($)</div>
                    <div class="col-span-1">Cant. x Envase</div>
                    <div class="col-span-1">$/Uso</div>
                    <div class="col-span-1">Bs/Uso</div>
                    <div class="col-span-1">%</div>
                    <div class="col-span-1"></div>
                </div>
                <div id="lista-insumos" class="space-y-4"></div>
                <button id="agregar-insumo" class="mt-4 w-full bg-emerald-600 hover:bg-emerald-700 text-white py-3 rounded-lg">Añadir Nuevo Insumo</button>
            </div>

            <div class="border-t border-gray-700 pt-6 space-y-6">
                <div class="bg-gray-900 p-4 rounded-lg">
                    <label class="block text-sm text-gray-400 mb-1">Costo Total</label>
                    <div id="costo-total" class="text-3xl text-amber-400 font-bold">$0.00</div>
                </div>

                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label for="margen-ganancia" class="block text-sm text-gray-400 mb-1">Margen de Ganancia (%)</label>
                        <input type="number" id="margen-ganancia" value="30" class="w-full bg-gray-700 text-white p-3 rounded-md">
                    </div>
                    <div>
                        <label for="ganancia-adicional" class="block text-sm text-gray-400 mb-1">Ganancia Adicional Fija ($)</label>
                        <input type="number" id="ganancia-adicional" class="w-full bg-gray-700 text-white p-3 rounded-md" placeholder="0.00">
                    </div>
                </div>
            </div>

            <div class="border-t border-gray-700 pt-6 text-center">
                <h2 class="text-xl font-semibold mb-4" id="titulo-venta">3. Precio de Venta Sugerido</h2>
                <div class="bg-emerald-500/20 border-2 border-emerald-500 text-emerald-400 p-6 rounded-2xl">
                    <div id="precio-original" class="text-lg text-emerald-300 mb-2">Precio exacto: $0.00</div>
                    <div id="precio-final" class="text-4xl font-bold">$0.00</div>
                    <div id="precio-bs" class="text-lg text-emerald-200 mt-2">Bs 0.00</div>
                    <button id="redondear" class="mt-4 bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg">Redondear valor</button>
                </div>
            </div>
        </main>
    </div>

    <footer class="text-center mt-12 text-sm text-gray-500">
        Hecho con amor por Ignacio Developer · <a href="https://pinto2291.github.io/ignacio_website/" target="_blank" class="text-emerald-400 hover:underline">Mi portafolio</a>
    </footer>

    <script>
        const formatter = new Intl.NumberFormat('es-VE', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        let insumoIdCounter = 0;

        const listaInsumos = document.getElementById('lista-insumos');
        const agregarInsumoBtn = document.getElementById('agregar-insumo');
        const costoTotalEl = document.getElementById('costo-total');
        const margenGananciaEl = document.getElementById('margen-ganancia');
        const gananciaAdicionalEl = document.getElementById('ganancia-adicional');
        const precioFinalEl = document.getElementById('precio-final');
        const precioOriginalEl = document.getElementById('precio-original');
        const precioBsEl = document.getElementById('precio-bs');
        const bcvInput = document.getElementById('bcv');
        const nombreProcedimiento = document.getElementById('nombre-procedimiento');
        const tituloVenta = document.getElementById('titulo-venta');

        const agregarInsumo = () => {
            insumoIdCounter++;
            const fila = document.createElement('div');
            fila.classList = 'grid grid-cols-7 md:grid-cols-8 gap-2 items-end bg-gray-700/40 p-3 rounded-lg';
            fila.innerHTML = `
                <input placeholder="Ej: Crema limpiadora" class="col-span-2 nombre-insumo bg-gray-700 text-white p-2 rounded" />
                <input type="number" placeholder="10.00" class="col-span-1 costo-envase bg-gray-700 text-white p-2 rounded" step="0.01">
                <input type="number" placeholder="25" class="col-span-1 cantidad-envase bg-gray-700 text-white p-2 rounded">
                <div class="col-span-1 text-amber-300 font-bold costo-dolar">$0.00</div>
                <div class="col-span-1 text-amber-300 font-bold costo-bolivar">Bs 0.00</div>
                <div class="col-span-1 text-white font-semibold porcentaje-insumo">0%</div>
                <button class="col-span-1 eliminar-insumo text-red-500 hover:text-red-700"><i data-lucide="trash-2"></i></button>
            `;
            listaInsumos.appendChild(fila);
            lucide.createIcons();
        };

        const calcularCostos = () => {
            let costoTotal = 0;
            const bcv = parseFloat(bcvInput.value) || 0;
            const filas = listaInsumos.querySelectorAll('div.grid');
            const costos = [];

            filas.forEach(fila => {
                const costoEnvase = parseFloat(fila.querySelector('.costo-envase').value) || 0;
                const cantidad = parseFloat(fila.querySelector('.cantidad-envase').value) || 1;
                const porUso = costoEnvase / cantidad;
                fila.querySelector('.costo-dolar').textContent = `$${formatter.format(porUso)}`;
                fila.querySelector('.costo-bolivar').textContent = `Bs ${formatter.format(porUso * bcv)}`;
                costos.push(porUso);
                costoTotal += porUso;
            });

            costoTotalEl.textContent = `$${formatter.format(costoTotal)}`;

            filas.forEach((fila, i) => {
                const porcentaje = costoTotal > 0 ? (costos[i] / costoTotal) * 100 : 0;
                fila.querySelector('.porcentaje-insumo').textContent = `${porcentaje.toFixed(1)}%`;
                fila.querySelector('.porcentaje-insumo').classList.toggle('text-red-400', porcentaje >= 50);
            });

            const margen = parseFloat(margenGananciaEl.value) || 0;
            const adicional = parseFloat(gananciaAdicionalEl.value) || 0;
            const final = costoTotal * (1 + margen / 100) + adicional;
            const bcvFinal = final * bcv;

            precioOriginalEl.textContent = `Precio exacto: $${formatter.format(final)}`;
            precioFinalEl.textContent = `$${formatter.format(final)}`;
            precioBsEl.textContent = `Bs ${formatter.format(bcvFinal)}`;

            const nombre = nombreProcedimiento.value.trim();
            tituloVenta.innerHTML = `3. Precio de Venta Sugerido de: <span class="text-emerald-400">${nombre || '---'}</span>`;
        };

        const redondearPrecio = () => {
            const original = parseFloat(precioOriginalEl.textContent.replace(/[^\d,\.]/g, '').replace(',', '.')) || 0;
            const redondeado = Math.ceil(original / 5) * 5;
            const bcv = parseFloat(bcvInput.value) || 0;
            const bs = redondeado * bcv;
            precioFinalEl.textContent = `$${formatter.format(redondeado)}`;
            precioBsEl.textContent = `Bs ${formatter.format(bs)}`;
        };

        listaInsumos.addEventListener('click', e => {
            if (e.target.closest('.eliminar-insumo')) {
                e.target.closest('div.grid').remove();
                calcularCostos();
            }
        });

        agregarInsumoBtn.addEventListener('click', agregarInsumo);
        document.body.addEventListener('input', calcularCostos);
        document.getElementById('redondear').addEventListener('click', redondearPrecio);

        agregarInsumo();
    </script>
</body>
</html>
